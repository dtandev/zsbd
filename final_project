CREATE DATABASE `cadastre`

CREATE TABLE `wojewodztwa` (
  `kod_wojewodztwa` varchar(2) NOT NULL,
  `nazwa_wojewodztwa` varchar(50) NOT NULL,
  PRIMARY KEY (`kod_wojewodztwa`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `powiaty` (
  `kod_powiatu` varchar(4) NOT NULL,
  `kod_wojewodztwa` varchar(2) NOT NULL,
  `nazwa_powiatu` varchar(50) NOT NULL,
  PRIMARY KEY (`kod_powiatu`),
  KEY `kod_wojewodztwa` (`kod_wojewodztwa`),
  CONSTRAINT `powiaty_ibfk_1` FOREIGN KEY (`kod_wojewodztwa`) REFERENCES `wojewodztwa` (`kod_wojewodztwa`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `gminy` (
  `kod_gminy` varchar(8) NOT NULL,
  `kod_powiatu` varchar(4) NOT NULL,
  `nazwa_gminy` varchar(80) NOT NULL,
  PRIMARY KEY (`kod_gminy`),
  KEY `kod_powiatu` (`kod_powiatu`),
  CONSTRAINT `gminy_ibfk_1` FOREIGN KEY (`kod_powiatu`) REFERENCES `powiaty` (`kod_powiatu`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `obreby_ewidencyjne` (
  `kod_obrebu_ewidencyjnego` varchar(13) NOT NULL,
  `kod_gminy` varchar(8) NOT NULL,
  PRIMARY KEY (`kod_obrebu_ewidencyjnego`),
  KEY `kod_gminy` (`kod_gminy`),
  CONSTRAINT `obreby_ewidencyjne_ibfk_1` FOREIGN KEY (`kod_gminy`) REFERENCES `gminy` (`kod_gminy`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `rejestr_gruntow` (
  `kod_dzialki` varchar(24) NOT NULL,
  `powierzchnia_dzialki` decimal(10,0) NOT NULL,
  `numer_KW` varchar(16) NOT NULL,
  `numer_arkusza_mapy` varchar(12) NOT NULL,
  `kod_obrebu_ewidencyjnego` varchar(13) DEFAULT NULL,
  PRIMARY KEY (`kod_dzialki`),
  KEY `numer_KW` (`numer_KW`),
  KEY `kod_obrebu_ewidencyjnego` (`kod_obrebu_ewidencyjnego`),
  CONSTRAINT `rejestr_gruntow_ibfk_1` FOREIGN KEY (`numer_KW`) REFERENCES `rejestr_KW` (`numer_KW`),
  CONSTRAINT `rejestr_gruntow_ibfk_2` FOREIGN KEY (`kod_obrebu_ewidencyjnego`) REFERENCES `obreby_ewidencyjne` (`kod_obrebu_ewidencyjnego`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `rejestr_KW` (
  `numer_KW` varchar(16) NOT NULL,
  `data_wpisu` date NOT NULL,
  PRIMARY KEY (`numer_KW`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `rejestr_budynkow` (
  `kod_budynku` varchar(24) NOT NULL,
  `kod_dzialki` varchar(24) NOT NULL,
  `powierzchnia_budynku` decimal(10,0) NOT NULL,
  PRIMARY KEY (`kod_budynku`),
  KEY `kod_dzialki` (`kod_dzialki`),
  CONSTRAINT `rejestr_budynkow_ibfk_1` FOREIGN KEY (`kod_dzialki`) REFERENCES `rejestr_gruntow` (`kod_dzialki`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `rejestr_wlascicieli` (
  `PESEL` int NOT NULL,
  `imie` varchar(30) NOT NULL,
  `nazwisko` varchar(30) NOT NULL,
  `adres` varchar(80) NOT NULL,
  PRIMARY KEY (`PESEL`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `rejestr_wlasnosci` (
  `numer_KW` varchar(16) NOT NULL,
  `PESEL` int NOT NULL,
  KEY `numer_KW` (`numer_KW`),
  KEY `PESEL` (`PESEL`),
  CONSTRAINT `rejestr_wlasnosci_ibfk_1` FOREIGN KEY (`numer_KW`) REFERENCES `rejestr_KW` (`numer_KW`),
  CONSTRAINT `rejestr_wlasnosci_ibfk_2` FOREIGN KEY (`PESEL`) REFERENCES `rejestr_wlascicieli` (`PESEL`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `ewidencja_podatkowa` (
  `kod_gminy` varchar(8) NOT NULL,
  `podatek_od_gruntu` decimal(10,0) NOT NULL,
  `podatek_od_budynku` decimal(10,0) NOT NULL,
  `wskaznik_biologiczny` decimal(10,0) NOT NULL,
  PRIMARY KEY (`kod_gminy`),
  CONSTRAINT `ewidencja_podatkowa_ibfk_1` FOREIGN KEY (`kod_gminy`) REFERENCES `gminy` (`kod_gminy`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

ALTER TABLE rejestr_wlasnosci 
ADD(PRIMARY KEY (numer_KW, PESEL))
